<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Каталог Dead Rails с поиском, фильтрами, корзиной, историей покупок, отзывами и помощью аккаунту.">
    <meta name="keywords" content="Dead Rails, классы, поезда, облигации, квесты, накрутка побед, магазин, отзывы">
    <title>Dead Rails</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: #0f0f0f;
            color: #f7f7f7;
            line-height: 1.6;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 15px;
        }
        .nickname-header {
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #f7f7f7;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nickname-header span {
            color: #047857;
            font-weight: 600;
        }
        .change-nickname {
            background: none;
            border: none;
            color: #047857;
            font-size: 0.9em;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s;
        }
        .change-nickname:hover {
            color: #035f44;
        }
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background: #1a1a1a;
            color: #f7f7f7;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #333;
        }
        .tab.active, .tab:hover {
            background: #047857;
            transform: translateY(-2px);
            border: 1px solid #047857;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        .controls input, .controls select {
            padding: 10px;
            border: none;
            border-radius: 6px;
            background: #262626;
            color: #f7f7f7;
            font-size: 0.9em;
            flex: 1;
            min-width: 120px;
            border: 1px solid #333;
        }
        .cart-tab {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #047857;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            z-index: 1000;
            transition: background 0.2s, transform 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid #047857;
        }
        .cart-tab:hover {
            background: #035f44;
            transform: translateY(-2px);
        }
        .cart-tab span {
            background: #f7f7f7;
            color: #047857;
            border-radius: 50%;
            padding: 2px 6px;
            margin-left: 5px;
            border: 1px solid #047857;
        }
        .category, .quests, .bonds, .wins {
            margin-bottom: 40px;
        }
        h2 {
            font-size: 1.8em;
            color: #047857;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            padding-bottom: 5px;
        }
        h2::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background: #047857;
        }
        h3 {
            font-size: 1.4em;
            color: #f7f7f7;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h4 {
            font-size: 1.2em;
            color: #047857;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .item-list, .quest-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }
        .item, .quest {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            transition: transform 0.3s, box-shadow 0.3s, border 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 1px solid #333;
        }
        .item:hover, .quest:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(4, 120, 87, 0.3);
            border: 1px solid #047857;
        }
        .item img, .quest img {
            width: 100%;
            max-width: 150px;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
            object-fit: cover;
            border: 1px solid #333;
        }
        .item h3, .quest h3 {
            font-size: 1.2em;
            color: #f7f7f7;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .item p, .quest p {
            font-size: 1.1em;
            color: #047857;
            font-weight: 600;
            margin-bottom: 12px;
        }
        .quest-description {
            font-size: 0.85em;
            color: #a3a3a3;
            margin-bottom: 12px;
            text-align: center;
            line-height: 1.4;
        }
        .quest-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 8px;
            fill: #047857;
        }
        .item button, .quest button, .bonds button, .wins button {
            width: 100%;
            padding: 10px;
            background: #047857;
            color: #f7f7f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #047857;
        }
        .item button:hover, .quest button:hover, .bonds button:hover, .wins button:hover {
            background: #035f44;
            transform: scale(1.05);
            border: 1px solid #035f44;
        }
        .catalog-section, .cart-section, .history-section, .reviews-section, .account-help-section {
            display: none;
        }
        .catalog-section.active, .cart-section.active, .history-section.active, .reviews-section.active, .account-help-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        .cart-items, .history-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .cart-item, .history-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        .cart-item h3, .history-item h3 {
            font-size: 1.1em;
            color: #f7f7f7;
            font-weight: 500;
        }
        .cart-item p, .history-item p {
            font-size: 1em;
            color: #047857;
            font-weight: 600;
        }
        .cart-item .remove-from-cart {
            padding: 8px 15px;
            background: #b91c1c;
            color: #f7f7f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #b91c1c;
        }
        .cart-item .remove-from-cart:hover {
            background: #991b1b;
            transform: scale(1.05);
            border: 1px solid #991b1b;
        }
        .cart-empty, .history-empty {
            font-size: 1.1em;
            text-align: center;
            color: #a3a3a3;
        }
        .cart-total {
            font-size: 1.3em;
            font-weight: 600;
            margin: 20px 0;
            color: #047857;
            text-align: right;
        }
        .cart-checkout {
            display: inline-block;
            padding: 12px 25px;
            background: #047857;
            color: #f7f7f7;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #047857;
        }
        .cart-checkout:hover {
            background: #035f44;
            transform: scale(1.05);
            border: 1px solid #035f44;
        }
        .clear-history {
            padding: 12px 25px;
            background: #b91c1c;
            color: #f7f7f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            display: block;
            margin: 20px auto;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #b91c1c;
        }
        .clear-history:hover {
            background: #991b1b;
            transform: scale(1.05);
            border: 1px solid #991b1b;
        }
        .reviews-form {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }
        .reviews-form textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #262626;
            color: #f7f7f7;
            font-size: 0.9em;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }
        .char-count {
            font-size: 0.8em;
            color: #a3a3a3;
            text-align: right;
            margin-bottom: 10px;
        }
        .reviews-form .file-input-container {
            margin-bottom: 15px;
        }
        .reviews-form input[type="file"] {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #262626;
            color: #f7f7f7;
            font-size: 0.9em;
            cursor: pointer;
            border: 1px solid #333;
        }
        .reviews-form input[type="file"]::-webkit-file-upload-button {
            background: #047857;
            color: #f7f7f7;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid #047857;
        }
        .reviews-form input[type="file"]::-webkit-file-upload-button:hover {
            background: #035f44;
            border: 1px solid #035f44;
        }
        .reviews-form .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
            border: 1px solid #333;
        }
        .reviews-form button {
            padding: 12px 25px;
            background: #047857;
            color: #f7f7f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #047857;
        }
        .reviews-form button:disabled {
            background: #3a4a44;
            cursor: not-allowed;
            border: 1px solid #3a4a44;
        }
        .reviews-form button:not(:disabled):hover {
            background: #035f44;
            transform: scale(1.05);
            border: 1px solid #035f44;
        }
        .reviews-channel {
            font-size: 0.9em;
            color: #a3a3a3;
            margin-bottom: 15px;
        }
        .reviews-channel a {
            color: #047857;
            text-decoration: none;
        }
        .reviews-channel a:hover {
            text-decoration: underline;
        }
        .delete-review {
            padding: 12px 25px;
            background: #b91c1c;
            color: #f7f7f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background 0.2s, transform 0.2s;
            margin-top: 10px;
            border: 1px solid #b91c1c;
        }
        .delete-review:disabled {
            background: #3a4a44;
            cursor: not-allowed;
            border: 1px solid #3a4a44;
        }
        .delete-review:not(:disabled):hover {
            background: #991b1b;
            transform: scale(1.05);
            border: 1px solid #991b1b;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 2px solid #047857;
        }
        .modal-content h3 {
            color: #047857;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .modal-content input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: none;
            border-radius: 8px;
            background: #262626;
            color: #f7f7f7;
            font-size: 0.9em;
            border: 1px solid #333;
        }
        .modal-content input[type="checkbox"] {
            margin-right: 8px;
            accent-color: #047857;
        }
        .modal-content label {
            font-size: 0.9em;
            color: #f7f7f7;
            margin-bottom: 15px;
            display: inline-block;
        }
        .modal-content button {
            padding: 12px 25px;
            background: #047857;
            color: #f7f7f7;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid #047857;
        }
        .modal-content button:disabled {
            background: #3a4a44;
            cursor: not-allowed;
            border: 1px solid #3a4a44;
        }
        .modal-content button:not(:disabled):hover {
            background: #035f44;
            transform: scale(1.05);
            border: 1px solid #035f44;
        }
        .modal-content .warning {
            color: #b91c1c;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .modal-content .close-button {
            display: none;
            margin-top: 15px;
        }
        .modal-content .close-button.active {
            display: inline-block;
        }
        .schedule {
            font-size: 1em;
            color: #a3a3a3;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }
        .bonds-controls, .wins-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .bonds-controls button, .wins-controls button {
            width: 40px;
            height: 40px;
            background: #262626;
            color: #f7f7f7;
            border: 1px solid #333;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }
        .bonds-controls button:hover, .wins-controls button:hover {
            background: #047857;
            transform: scale(1.05);
            border: 1px solid #047857;
        }
        .bonds-controls button:disabled, .wins-controls button:disabled {
            background: #3a4a44;
            cursor: not-allowed;
            border: 1px solid #3a4a44;
        }
        .bonds-controls span, .wins-controls span {
            font-size: 1.1em;
            color: #f7f7f7;
            min-width: 40px;
            text-align: center;
        }
        .bonds-total, .wins-total {
            font-size: 1.1em;
            color: #047857;
            font-weight: 600;
            margin-bottom: 12px;
        }
        footer {
            text-align: center;
            padding: 20px;
            background: #1a1a1a;
            color: #a3a3a3;
            font-size: 0.9em;
            margin-top: 40px;
            border-top: 1px solid #262626;
        }
        footer a {
            color: #047857;
            text-decoration: none;
            margin: 0 10px;
        }
        footer a:hover {
            text-decoration: underline;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 600px) {
            .controls {
                flex-direction: column;
                gap: 8px;
            }
            .controls input, .controls select {
                width: 100%;
                border: 1px solid #333;
            }
            h2 {
                font-size: 1.5em;
            }
            h3 {
                font-size: 1.2em;
            }
            h4 {
                font-size: 1.1em;
            }
            .item-list, .cart-items, .history-items, .quest-list {
                grid-template-columns: 1fr;
            }
            .item, .cart-item, .history-item, .quest {
                padding: 15px;
                border: 1px solid #333;
            }
            .item img, .quest img {
                max-width: 120px;
            }
            .item h3, .quest h3 {
                font-size: 1.1em;
            }
            .item p, .quest p {
                font-size: 1em;
            }
            .quest-description {
                font-size: 0.8em;
            }
            .item button, .quest button, .bonds button, .wins button {
                font-size: 0.85em;
                padding: 8px;
                border: 1px solid #047857;
            }
            .cart-tab {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
            }
            .cart-total {
                text-align: center;
            }
            .modal-content {
                padding: 15px;
                border: 1px solid #047857;
            }
            .nickname-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .reviews-form {
                padding: 15px;
                border: 1px solid #333;
            }
            .reviews-form textarea {
                min-height: 100px;
                border: 1px solid #333;
            }
            .reviews-form .image-preview {
                max-height: 150px;
                border: 1px solid #333;
            }
            .reviews-channel {
                font-size: 0.8em;
                margin-bottom: 10px;
            }
            .char-count {
                font-size: 0.7em;
            }
            .delete-review {
                font-size: 0.8em;
                padding: 8px 15px;
                border: 1px solid #b91c1c;
            }
            .schedule {
                font-size: 0.9em;
            }
            .bonds-controls button, .wins-controls button {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }
            .bonds-controls span, .wins-controls span {
                font-size: 1em;
                min-width: 35px;
            }
            .bonds-total, .wins-total {
                font-size: 1em;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="modal" id="nickname-modal">
        <div class="modal-content">
            <h3>Введите ваш ник</h3>
            <p class="warning">Если ты не введёшь ник, то будут проблемы, и мы не несём за это ответственность.</p>
            <input type="text" id="nickname-input" placeholder="Ваш ник...">
            <label>
                <input type="checkbox" id="accept-terms"> Принять условие
            </label>
            <button id="submit-nickname" disabled>Подтвердить</button>
        </div>
    </div>

    <div class="modal" id="warning-modal">
        <div class="modal-content">
            <h3>ВАЖНОЕ ПРЕДУПРЕЖДЕНИЕ</h3>
            <p>После покупки вас переведёт в Telegram, и это важно, чтобы мы могли выдать купленное.</p>
            <button id="close-warning" class="close-button">Закрыть</button>
        </div>
    </div>

    <div class="container">
        <div class="nickname-header">
            Ваш ник: <span id="nickname-display">Гость</span>
            <button class="change-nickname">Сменить ник</button>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="catalog">Каталог</div>
            <div class="tab" data-tab="cart">Корзина</div>
            <div class="tab" data-tab="history">История</div>
            <div class="tab" data-tab="reviews">Отзывы</div>
            <div class="tab" data-tab="account-help">Помощь аккаунту</div>
        </div>

        <div class="cart-tab" data-tab="cart">
            Корзина <span id="cart-count">0</span>
        </div>

        <div class="catalog-section active">
            <div class="controls">
                <input type="text" id="search" placeholder="Поиск по названию...">
                <select id="category">
                    <option value="all">Все категории</option>
                    <option value="classes">Классы</option>
                    <option value="trains">Поезда</option>
                </select>
                <select id="sort">
                    <option value="default">По умолчанию</option>
                    <option value="price-asc">Цена: по возрастанию</option>
                    <option value="price-desc">Цена: по убыванию</option>
                    <option value="name">По алфавиту</option>
                </select>
            </div>

            <div class="category" id="classes">
                <h2>Классы</h2>
                <div class="item-list">
                    <div class="item" data-name="Доктор" data-price="26" data-category="classes">
                        <img src="" alt="Доктор" class="item-image">
                        <h3>Доктор</h3>
                        <p>26 тг</p>
                        <button class="add-to-cart" data-name="Доктор" data-price="26">Добавить</button>
                    </div>
                    <div class="item" data-name="Майнер" data-price="30" data-category="classes">
                        <img src="" alt="Майнер" class="item-image">
                        <h3>Майнер</h3>
                        <p>30 тг</p>
                        <button class="add-to-cart" data-name="Майнер" data-price="30">Добавить</button>
                    </div>
                    <div class="item" data-name="Музыкант" data-price="30" data-category="classes">
                        <img src="" alt="Музыкант" class="item-image">
                        <h3>Музыкант</h3>
                        <p>30 тг</p>
                        <button class="add-to-cart" data-name="Музыкант" data-price="30">Добавить</button>
                    </div>
                    <div class="item" data-name="Арсонист" data-price="40" data-category="classes">
                        <img src="" alt="Арсонист" class="item-image">
                        <h3>Арсонист</h3>
                        <p>40 тг</p>
                        <button class="add-to-cart" data-name="Арсонист" data-price="40">Добавить</button>
                    </div>
                    <div class="item" data-name="Мастер упаковки" data-price="55" data-category="classes">
                        <img src="" alt="Мастер упаковки" class="item-image">
                        <h3>Мастер упаковки</h3>
                        <p>55 тг</p>
                        <button class="add-to-cart" data-name="Мастер упаковки" data-price="55">Добавить</button>
                    </div>
                    <div class="item" data-name="Некромант" data-price="55" data-category="classes">
                        <img src="" alt="Некромант" class="item-image">
                        <h3>Некромант</h3>
                        <p>55 тг</p>
                        <button class="add-to-cart" data-name="Некромант" data-price="55">Добавить</button>
                    </div>
                    <div class="item" data-name="Аламо" data-price="80" data-category="classes">
                        <img src="" alt="Аламо" class="item-image">
                        <h3>Аламо</h3>
                        <p>80 тг</p>
                        <button class="add-to-cart" data-name="Аламо" data-price="80">Добавить</button>
                    </div>
                    <div class="item" data-name="Ковбой" data-price="75" data-category="classes">
                        <img src="" alt="Ковбой" class="item-image">
                        <h3>Ковбой</h3>
                        <p>75 тг</p>
                        <button class="add-to-cart" data-name="Ковбой" data-price="75">Добавить</button>
                    </div>
                    <div class="item" data-name="Кондуктор" data-price="75" data-category="classes">
                        <img src="" alt="Кондуктор" class="item-image">
                        <h3>Кондуктор</h3>
                        <p>75 тг</p>
                        <button class="add-to-cart" data-name="Кондуктор" data-price="75">Добавить</button>
                    </div>
                    <div class="item" data-name="Высокий роллер" data-price="80" data-category="classes">
                        <img src="" alt="Высокий роллер" class="item-image">
                        <h3>Высокий роллер</h3>
                        <p>80 тг</p>
                        <button class="add-to-cart" data-name="Высокий роллер" data-price="80">Добавить</button>
                    </div>
                    <div class="item" data-name="Вереволк" data-price="80" data-category="classes">
                        <img src="" alt="Вереволк" class="item-image">
                        <h3>Вереволк</h3>
                        <p>80 тг</p>
                        <button class="add-to-cart" data-name="Вереволк" data-price="80">Добавить</button>
                    </div>
                    <div class="item" data-name="Выживший" data-price="100" data-category="classes">
                        <img src="" alt="Выживший" class="item-image">
                        <h3>Выживший</h3>
                        <p>100 тг</p>
                        <button class="add-to-cart" data-name="Выживший" data-price="100">Добавить</button>
                    </div>
                    <div class="item" data-name="Священник" data-price="100" data-category="classes">
                        <img src="" alt="Священник" class="item-image">
                        <h3>Священник</h3>
                        <p>100 тг</p>
                        <button class="add-to-cart" data-name="Священник" data-price="100">Добавить</button>
                    </div>
                    <div class="item" data-name="Вампир" data-price="103" data-category="classes">
                        <img src="" alt="Вампир" class="item-image">
                        <h3>Вампир</h3>
                        <p>103 тг</p>
                        <button class="add-to-cart" data-name="Вампир" data-price="103">Добавить</button>
                    </div>
                    <div class="item" data-name="Зомби" data-price="105" data-category="classes">
                        <img src="" alt="Зомби" class="item-image">
                        <h3>Зомби</h3>
                        <p>105 тг</p>
                        <button class="add-to-cart" data-name="Зомби" data-price="105">Добавить</button>
                    </div>
                    <div class="item" data-name="Железный человек" data-price="155" data-category="classes">
                        <img src="" alt="Железный человек" class="item-image">
                        <h3>Железный человек</h3>
                        <p>155 тг</p>
                        <button class="add-to-cart" data-name="Железный человек" data-price="155">Добавить</button>
                    </div>
                    <div class="item" data-name="Милкмен" data-price="90" data-category="classes">
                        <img src="" alt="Милкмен" class="item-image">
                        <h3>Милкмен</h3>
                        <p>90 тг</p>
                        <button class="add-to-cart" data-name="Милкмен" data-price="90">Добавить</button>
                    </div>
                </div>
            </div>

            <div class="category" id="trains">
                <h2>Поезда</h2>
                <div class="item-list">
                    <div class="item" data-name="Крупный рогатый скот" data-price="225" data-category="trains">
                        <img src="" alt="Крупный рогатый скот" class="item-image">
                        <h3>Крупный рогатый скот</h3>
                        <p>225 тг</p>
                        <button class="add-to-cart" data-name="Крупный рогатый скот" data-price="225">Добавить</button>
                    </div>
                    <div class="item" data-name="Золотая лихорадка" data-price="300" data-category="trains">
                        <img src="" alt="Золотая лихорадка" class="item-image">
                        <h3>Золотая лихорадка</h3>
                        <p>300 тг</p>
                        <button class="add-to-cart" data-name="Золотая лихорадка" data-price="300">Добавить</button>
                    </div>
                    <div class="item" data-name="Бронированный" data-price="320" data-category="trains">
                        <img src="" alt="Бронированный" class="item-image">
                        <h3>Бронированный</h3>
                        <p>320 тг</p>
                        <button class="add-to-cart" data-name="Бронированный" data-price="320">Добавить</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="cart-section">
            <h2>Корзина</h2>
            <div class="cart-items" id="cart-items"></div>
            <div class="cart-total">Итого: <span id="cart-total">0 тг</span></div>
            <a href="https://t.me/Aibekxcdm815" target="_blank" class="cart-checkout hidden" id="cart-checkout">Оформить заказ</a>
        </div>

        <div class="history-section">
            <h2>История покупок</h2>
            <div class="history-items" id="history-items"></div>
            <button class="clear-history hidden" id="clear-history">Очистить историю</button>
        </div>

        <div class="reviews-section">
            <h2>Отзывы</h2>
            <p class="reviews-channel">Наш канал с отзывами: <a href="https://t.me/AibaTimaBeka" target="_blank">МёртвыеРельсыОтзывы</a></p>
            <div class="reviews-form">
                <textarea id="review-text" placeholder="Напишите ваш отзыв..."></textarea>
                <p class="char-count">Осталось: <span id="char-count">500</span> символов</p>
                <div class="file-input-container">
                    <input type="file" id="review-image" accept="image/*">
                    <img id="image-preview" class="image-preview" alt="Предпросмотр изображения">
                </div>
                <button id="submit-review" disabled>Отправить</button>
            </div>
            <button class="delete-review" id="delete-review" disabled>Удалить мой последний отзыв</button>
        </div>

        <div class="account-help-section">
            <h2>Помощь аккаунту</h2>
            <p class="schedule">ПОМОЩЬ АККАУНТУ ДОСТУПНА ПО БУДНЯМ В 20:00, ПО ВЫХОДНЫМ — В ЛЮБОЕ ВРЕМЯ</p>
            <div class="quests">
                <h3>Завершение квестов</h3>
                <div class="quest-list">
                    <div class="quest" data-name="Стрелок" data-price="150">
                        <img src="" alt="Стрелок" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14l-1.5 6h3L12 6zm0 8a2 2 0 100 4 2 2 0 000-4z"/></svg>
                        <h3>Стрелок</h3>
                        <p class="quest-description">Имейте 20 оружия в своём инвентаре</p>
                        <p>150 тг</p>
                        <button class="add-to-cart" data-name="Квест: Стрелок" data-price="150">Добавить</button>
                    </div>
                    <div class="quest" data-name="Магнат" data-price="150">
                        <img src="" alt="Магнат" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14v12m-4-8h8"/></svg>
                        <h3>Магнат</h3>
                        <p class="quest-description">Получите более 1000 игровых долларов в одной игре</p>
                        <p>150 тг</p>
                        <button class="add-to-cart" data-name="Квест: Магнат" data-price="150">Добавить</button>
                    </div>
                    <div class="quest" data-name="Неубиваемый" data-price="250">
                        <img src="" alt="Неубиваемый" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12l-4 4h8l-4-4z"/></svg>
                        <h3>Неубиваемый</h3>
                        <p class="quest-description">Завершите игру, не убив ни одного игрока</p>
                        <p>250 тг</p>
                        <button class="add-to-cart" data-name="Квест: Неубиваемый" data-price="250">Добавить</button>
                    </div>
                    <div class="quest" data-name="Пони экспресс" data-price="250">
                        <img src="" alt="Пони экспресс" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm2-10h-4v4h4v-4z"/></svg>
                        <h3>Пони экспресс</h3>
                        <p class="quest-description">Завершите игру без игрока, использующего поезд</p>
                        <p>250 тг</p>
                        <button class="add-to-cart" data-name="Квест: Пони экспресс" data-price="250">Добавить</button>
                    </div>
                    <div class="quest" data-name="Пацифист" data-price="250">
                        <img src="" alt="Пацифист" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12v8m-4-4h8"/></svg>
                        <h3>Пацифист</h3>
                        <p class="quest-description">Завершите игру, не убив врага</p>
                        <p>250 тг</p>
                        <button class="add-to-cart" data-name="Квест: Пацифист" data-price="250">Добавить</button>
                    </div>
                    <div class="quest" data-name="Куча долларов" data-price="250">
                        <img src="" alt="Куча долларов" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-6h4v2h-4v-2zm0-4h4v2h-4v-2z"/></svg>
                        <h3>Куча долларов</h3>
                        <p class="quest-description">Завершите игру, ничего не продавая</p>
                        <p>250 тг</p>
                        <button class="add-to-cart" data-name="Квест: Куча долларов" data-price="250">Добавить</button>
                    </div>
                    <div class="quest" data-name="Электричество осталось" data-price="300">
                        <img src="" alt="Электричество осталось" class="quest-image">
                        <svg class="quest-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-10l-3 4h6l-3-4z"/></svg>
                        <h3>Электричество осталось</h3>
                        <p class="quest-description">Продать труп последнего босса Теслы</p>
                        <p>300 тг</p>
                        <button class="add-to-cart" data-name="Квест: Электричество осталось" data-price="300">Добавить</button>
                    </div>
                </div>
            </div>
            <div class="bonds">
                <h3>Покупка облигаций</h3>
                <div class="bonds-v2" style="margin-top: 25px;">
                    <h4>Облигации v2: Опасные, но эффективные</h4>
                    <p>Цена: 150 тг за 1 минуту</p>
                    <div class="bonds-controls">
                        <button id="bonds-v2-decrement">−</button>
                        <span id="bonds-v2-count">1</span>
                        <button id="bonds-v2-increment">+</button>
                    </div>
                    <p class="bonds-total">Итого: <span id="bonds-v2-total">150 тг</span></p>
                    <button id="add-bonds-v2-to-cart">Добавить в корзину</button>
                </div>
            </div>
            <div class="wins">
                <h3>Накрутка побед</h3>
                <p>Цена: 100 тг за 1 победу</p>
                <div class="wins-controls">
                    <button id="wins-decrement">−</button>
                    <span id="wins-count">1</span>
                    <button id="wins-increment">+</button>
                </div>
                <p class="wins-total">Итого: <span id="wins-total">100 тг</span></p>
                <button id="add-wins-to-cart">Добавить в корзину</button>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2025 Temirlan, Bekzhan | <a href="https://t.me/Aibekxcdm815">Telegram</a> | <a href="https://tiktok.com/@deadrailsshop04">TikTok</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Инициализация данных
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let purchaseHistory = JSON.parse(localStorage.getItem('purchaseHistory')) || [];

            // Элементы DOM
            const nicknameModal = document.getElementById('nickname-modal');
            const warningModal = document.getElementById('warning-modal');
            const nicknameInput = document.getElementById('nickname-input');
            const acceptTerms = document.getElementById('accept-terms');
            const submitNickname = document.getElementById('submit-nickname');
            const closeWarning = document.getElementById('close-warning');
            const nicknameDisplay = document.getElementById('nickname-display');
            const changeNickname = document.querySelector('.change-nickname');
            const cartCount = document.getElementById('cart-count');
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const cartCheckout = document.getElementById('cart-checkout');
            const historyItemsContainer = document.getElementById('history-items');
            const clearHistory = document.getElementById('clear-history');
            const reviewText = document.getElementById('review-text');
            const reviewImage = document.getElementById('review-image');
            const imagePreview = document.getElementById('image-preview');
            const submitReview = document.getElementById('submit-review');
            const deleteReview = document.getElementById('delete-review');
            const charCount = document.getElementById('char-count');
            const searchInput = document.getElementById('search');
            const categorySelect = document.getElementById('category');
            const sortSelect = document.getElementById('sort');
            const bondsV2Decrement = document.getElementById('bonds-v2-decrement');
            const bondsV2Increment = document.getElementById('bonds-v2-increment');
            const bondsV2Count = document.getElementById('bonds-v2-count');
            const bondsV2Total = document.getElementById('bonds-v2-total');
            const addBondsV2ToCart = document.getElementById('add-bonds-v2-to-cart');
            const winsDecrement = document.getElementById('wins-decrement');
            const winsIncrement = document.getElementById('wins-increment');
            const winsCount = document.getElementById('wins-count');
            const winsTotal = document.getElementById('wins-total');
            const addWinsToCart = document.getElementById('add-wins-to-cart');
            const tabs = document.querySelectorAll('.tab');
            const sections = document.querySelectorAll('.catalog-section, .cart-section, .history-section, .reviews-section, .account-help-section');

            // Настройки Telegram и Discord
            const telegramBotToken = '7943317013:AAHfZ__FYakxqBHqdOInE-17uXzU2MW8dhU';
            const telegramChatId = '-1002556048787';
            const discordWebhookUrl = 'https://discord.com/api/webhooks/1372290951565017201/gbPZqGrNeZUXlr0TH2ftVQwxDi70xtrPtqertUrHq6aOgT4rYBT6BICnRLAHvHgoPSjz';

            // Переключение вкладок
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active'));
                    tab.classList.add('active');
                    document.querySelector(`.${tab.dataset.tab}-section`).classList.add('active');
                });
            });

            // Обновление отображения ника
            function updateNicknameDisplay() {
                const nickname = localStorage.getItem('nickname') || 'Гость';
                nicknameDisplay.textContent = nickname;
            }

            // Проверка ника при загрузке
            if (!localStorage.getItem('nickname')) {
                nicknameModal.style.display = 'flex';
            } else {
                nicknameModal.style.display = 'none';
                warningModal.style.display = 'none';
                updateNicknameDisplay();
            }

            // Обработчик согласия с условиями
            acceptTerms.addEventListener('change', () => {
                submitNickname.disabled = !acceptTerms.checked;
            });

            // Обработка отправки ника
            function handleSubmitNickname() {
                const nickname = nicknameInput.value.trim();
                if (nickname && acceptTerms.checked) {
                    localStorage.setItem('nickname', nickname);
                    nicknameModal.style.display = 'none';
                    warningModal.style.display = 'flex';
                    nicknameInput.value = '';
                    acceptTerms.checked = false;
                    submitNickname.disabled = true;
                    updateNicknameDisplay();
                    setTimeout(() => {
                        closeWarning.classList.add('active');
                    }, 5000);
                } else if (!nickname) {
                    alert('Пожалуйста, введите ник!');
                } else {
                    alert('Пожалуйста, примите условие!');
                }
            }

            submitNickname.addEventListener('click', handleSubmitNickname);
            submitNickname.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleSubmitNickname();
            });

            nicknameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSubmitNickname();
                }
            });

            // Закрытие модального окна предупреждения
            closeWarning.addEventListener('click', () => {
                warningModal.style.display = 'none';
            });

            closeWarning.addEventListener('touchstart', (e) => {
                e.preventDefault();
                warningModal.style.display = 'none';
            });

            // Смена ника
            changeNickname.addEventListener('click', () => {
                nicknameModal.style.display = 'flex';
            });

            // Обновление счетчика корзины
            function updateCartCount() {
                cartCount.textContent = cart.length;
            }

            // Обновление отображения корзины
            function updateCartDisplay() {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="cart-empty">Корзина пуста</p>';
                    cartCheckout.classList.add('hidden');
                } else {
                    cart.forEach((item, index) => {
                        const cartItem = document.createElement('div');
                        cartItem.className = 'cart-item';
                        cartItem.innerHTML = `
                            <h3>${item.name}</h3>
                            <p>${item.price} тг</p>
                            <button class="remove-from-cart" data-index="${index}">Удалить</button>
                        `;
                        cartItemsContainer.appendChild(cartItem);
                    });
                    cartCheckout.classList.remove('hidden');
                }
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                cartTotal.textContent = `${total} тг`;
            }

            // Обновление истории покупок
            function updateHistoryDisplay() {
                historyItemsContainer.innerHTML = '';
                if (purchaseHistory.length === 0) {
                    historyItemsContainer.innerHTML = '<p class="history-empty">История пуста</p>';
                    clearHistory.classList.add('hidden');
                } else {
                    purchaseHistory.forEach((purchase, index) => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item';
                        const itemList = purchase.items.map(item => `
                            <div class="history-item-details">
                                ${item.name} (${item.price} тг)
                            </div>
                        `).join('');
                        historyItem.innerHTML = `
                            <h3>Покупка #${index + 1}</h3>
                            <p>Дата: ${purchase.date}</p>
                            <p>Ник: ${purchase.nickname}</p>
                            <p>Товары: ${itemList}</p>
                            <p>Итого: ${purchase.total} тг</p>
                        `;
                        historyItemsContainer.appendChild(historyItem);
                    });
                    clearHistory.classList.remove('hidden');
                }
            }

            // Добавление в корзину
            function addToCart(name, price) {
                cart.push({ name, price: Number(price) });
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                updateCartDisplay();
            }

            // Удаление из корзины
            function removeFromCart(index) {
                cart.splice(index, 1);
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                updateCartDisplay();
            }

            // Оформление заказа
            function checkout() {
                if (cart.length === 0) return;
                const nickname = localStorage.getItem('nickname') || 'Гость';
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                const date = new Date().toLocaleString('ru-RU');
                const purchase = { nickname, items: [...cart], total, date };
                purchaseHistory.push(purchase);
                localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));

                const itemsList = cart.map(item => `${item.name} (${item.price} тг)`).join(', ');
                const discordMessage = {
                    content: `${nickname} купил: ${itemsList} (Итого: ${total} тг)`
                };
                fetch(discordWebhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(discordMessage)
                }).catch(error => {
                    console.error('Ошибка отправки в Discord:', error);
                    alert('Ошибка при отправке уведомления о покупке. Проверьте подключение.');
                });

                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                updateCartDisplay();
                updateHistoryDisplay();
            }

            // Очистка истории
            function clearPurchaseHistory() {
                purchaseHistory = [];
                localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
                updateHistoryDisplay();
            }

            // Обработка ввода отзыва
            const maxChars = 500;
            reviewText.addEventListener('input', () => {
                const remaining = maxChars - reviewText.value.length;
                charCount.textContent = remaining;
                if (remaining < 0) {
                    reviewText.value = reviewText.value.slice(0, maxChars);
                    charCount.textContent = 0;
                }
                updateSubmitButton();
            });

            // Обработка загрузки изображения отзыва
            reviewImage.addEventListener('change', () => {
                const file = reviewImage.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.src = '';
                    imagePreview.style.display = 'none';
                }
                updateSubmitButton();
            });

            // Обновление кнопки отправки отзыва
            function updateSubmitButton() {
                const hasText = reviewText.value.trim().length > 0;
                const hasImage = reviewImage.files.length > 0;
                submitReview.disabled = !(hasText || hasImage);
            }

            // Отправка отзыва
            async function sendReview() {
                const review = reviewText.value.trim();
                const file = reviewImage.files[0];
                const nickname = localStorage.getItem('nickname') || 'Гость';

                if (!review && !file) {
                    alert('Пожалуйста, напишите отзыв или прикрепите фото!');
                    return;
                }

                try {
                    let messageId = null;
                    if (file) {
                        const formData = new FormData();
                        formData.append('chat_id', telegramChatId);
                        formData.append('photo', file);
                        formData.append('caption', review ? `Отзыв от ${nickname}: ${review}` : `Отзыв от ${nickname}`);

                        const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendPhoto`, {
                            method: 'POST',
                            body: formData
                        });
                        const data = await response.json();

                        if (!response.ok) {
                            console.error('Ошибка отправки в Telegram:', response.status, data);
                            alert('Ошибка при отправке отзыва в Telegram. Попробуйте позже.');
                            return;
                        }
                        messageId = data.result.message_id;
                    } else if (review) {
                        const telegramMessage = `Отзыв от ${nickname}: ${review}`;
                        const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                chat_id: telegramChatId,
                                text: telegramMessage
                            })
                        });
                        const data = await response.json();

                        if (!response.ok) {
                            console.error('Ошибка отправки в Telegram:', response.status, data);
                            alert('Ошибка при отправке отзыва в Telegram. Попробуйте позже.');
                            return;
                        }
                        messageId = data.result.message_id;
                    }

                    if (messageId) {
                        localStorage.setItem(`lastReview_${nickname}`, JSON.stringify({
                            messageId,
                            timestamp: Date.now()
                        }));
                    }

                    reviewText.value = '';
                    reviewImage.value = '';
                    imagePreview.src = '';
                    imagePreview.style.display = 'none';
                    submitReview.disabled = true;
                    charCount.textContent = maxChars;
                    alert('Спасибо за ваш отзыв!');
                    checkUserReview();
                } catch (error) {
                    console.error('Ошибка отправки отзыва:', error);
                    alert('Ошибка при отправке отзыва. Проверьте подключение.');
                }
            }

            // Проверка наличия отзыва пользователя
            async function checkUserReview() {
                const nickname = localStorage.getItem('nickname') || 'Гость';
                const lastReview = JSON.parse(localStorage.getItem(`lastReview_${nickname}`));
                if (!lastReview) {
                    deleteReview.disabled = true;
                    return;
                }

                const { messageId, timestamp } = lastReview;
                const now = Date.now();
                const hoursPassed = (now - timestamp) / (1000 * 60 * 60);

                if (hoursPassed > 48) {
                    localStorage.removeItem(`lastReview_${nickname}`);
                    deleteReview.disabled = true;
                    return;
                }

                deleteReview.disabled = false;
            }

            // Удаление отзыва
            async function deleteUserReview() {
                const nickname = localStorage.getItem('nickname') || 'Гость';
                const lastReview = JSON.parse(localStorage.getItem(`lastReview_${nickname}`));
                if (!lastReview) return;

                const { messageId } = lastReview;
                try {
                    const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/deleteMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: telegramChatId,
                            message_id: messageId
                        })
                    });
                    const data = await response.json();

                    if (response.ok && data.ok) {
                        localStorage.removeItem(`lastReview_${nickname}`);
                        alert('Ваш последний отзыв удалён.');
                        deleteReview.disabled = true;
                    } else {
                        console.error('Ошибка удаления сообщения:', response.status, data);
                        alert('Ошибка при удалении отзыва. Возможно, отзыв уже удалён или срок истёк.');
                    }
                } catch (error) {
                    console.error('Ошибка удаления отзыва:', error);
                    alert('Ошибка при удалении отзыва. Проверьте подключение.');
                }
            }

            // Фильтрация и сортировка каталога
            function filterAndSortItems() {
                const search = searchInput.value.toLowerCase();
                const category = categorySelect.value;
                const sort = sortSelect.value;

                const items = document.querySelectorAll('.item');
                let filteredItems = Array.from(items);

                // Фильтрация по поиску и категории
                filteredItems = filteredItems.filter(item => {
                    const name = item.dataset.name.toLowerCase();
                    const itemCategory = item.dataset.category;
                    const matchesSearch = name.includes(search);
                    const matchesCategory = category === 'all' || itemCategory === category;
                    return matchesSearch && matchesCategory;
                });

                // Сортировка
                filteredItems.sort((a, b) => {
                    const nameA = a.dataset.name.toLowerCase();
                    const nameB = b.dataset.name.toLowerCase();
                    const priceA = Number(a.dataset.price);
                    const priceB = Number(b.dataset.price);

                    if (sort === 'price-asc') {
                        return priceA - priceB;
                    } else if (sort === 'price-desc') {
                        return priceB - priceA;
                    } else if (sort === 'name') {
                        return nameA.localeCompare(nameB);
                    }
                    return 0;
                });

                // Обновление отображения
                const classesContainer = document.querySelector('#classes .item-list');
                const trainsContainer = document.querySelector('#trains .item-list');
                classesContainer.innerHTML = '';
                trainsContainer.innerHTML = '';

                filteredItems.forEach(item => {
                    const itemCategory = item.dataset.category;
                    if (itemCategory === 'classes') {
                        classesContainer.appendChild(item);
                    } else if (itemCategory === 'trains') {
                        trainsContainer.appendChild(item);
                    }
                });

                // Скрытие пустых категорий
                document.getElementById('classes').style.display = classesContainer.children.length > 0 ? 'block' : 'none';
                document.getElementById('trains').style.display = trainsContainer.children.length > 0 ? 'block' : 'none';
            }

            // Управление облигациями v2
            let bondsV2Quantity = 1;
            const bondV2Price = 150;

            function updateBondsV2Display() {
                bondsV2Count.textContent = bondsV2Quantity;
                bondsV2Total.textContent = `${bondsV2Quantity * bondV2Price} тг`;
                bondsV2Decrement.disabled = bondsV2Quantity <= 1;
            }

            bondsV2Increment.addEventListener('click', () => {
                bondsV2Quantity++;
                updateBondsV2Display();
            });

            bondsV2Decrement.addEventListener('click', () => {
                if (bondsV2Quantity > 1) {
                    bondsV2Quantity--;
                    updateBondsV2Display();
                }
            });

            addBondsV2ToCart.addEventListener('click', () => {
                const name = `Облигации v2 (${bondsV2Quantity} мин.)`;
                const price = bondsV2Quantity * bondV2Price;
                addToCart(name, price);
                bondsV2Quantity = 1;
                updateBondsV2Display();
            });

            // Управление накруткой побед
            let winsQuantity = 1;
            const winPrice = 100;

            function updateWinsDisplay() {
                winsCount.textContent = winsQuantity;
                winsTotal.textContent = `${winsQuantity * winPrice} тг`;
                winsDecrement.disabled = winsQuantity <= 1;
            }

            winsIncrement.addEventListener('click', () => {
                winsQuantity++;
                updateWinsDisplay();
            });

            winsDecrement.addEventListener('click', () => {
                if (winsQuantity > 1) {
                    winsQuantity--;
                    updateWinsDisplay();
                }
            });

            addWinsToCart.addEventListener('click', () => {
                const name = `Накрутка побед (${winsQuantity} шт.)`;
                const price = winsQuantity * winPrice;
                addToCart(name, price);
                winsQuantity = 1;
                updateWinsDisplay();
            });

            // Обработчики событий для фильтров и сортировки
            searchInput.addEventListener('input', filterAndSortItems);
            categorySelect.addEventListener('change', filterAndSortItems);
            sortSelect.addEventListener('change', filterAndSortItems);

            // Обработчик добавления в корзину
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart')) {
                    const name = e.target.dataset.name;
                    const price = e.target.dataset.price;
                    addToCart(name, price);
                }
            });

            // Обработчик удаления из корзины
            cartItemsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-from-cart')) {
                    const index = e.target.dataset.index;
                    removeFromCart(index);
                }
            });

            // Обработчик оформления заказа
            cartCheckout.addEventListener('click', () => {
                if (cart.length > 0) {
                    checkout();
                    warningModal.style.display = 'flex';
                    setTimeout(() => {
                        closeWarning.classList.add('active');
                    }, 5000);
                }
            });

            // Обработчик очистки истории
            clearHistory.addEventListener('click', clearPurchaseHistory);

            // Обработчик отправки отзыва
            submitReview.addEventListener('click', async () => {
                await sendReview();
            });

            submitReview.addEventListener('touchstart', async (e) => {
                e.preventDefault();
                await sendReview();
            });

            // Обработчик удаления отзыва
            deleteReview.addEventListener('click', async () => {
                await deleteUserReview();
            });

            deleteReview.addEventListener('touchstart', async (e) => {
                e.preventDefault();
                await deleteUserReview();
            });

            // Инициализация отображения
            updateCartCount();
            updateCartDisplay();
            updateHistoryDisplay();
            checkUserReview();
            filterAndSortItems();
            updateBondsV2Display();
            updateWinsDisplay();

            // Обработка изменения размера окна для адаптивности
            window.addEventListener('resize', () => {
                filterAndSortItems();
            });

            // Предотвращение отправки формы по умолчанию
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                });
            });

            // Добавление анимации при загрузке
            document.querySelectorAll('.category, .quests, .bonds, .wins').forEach(category => {
                category.style.opacity = '0';
                setTimeout(() => {
                    category.style.transition = 'opacity 0.5s ease-in';
                    category.style.opacity = '1';
                }, 100);
            });

            // Обработка кликов по корзине в фиксированной вкладке
            document.querySelector('.cart-tab').addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                sections.forEach(s => s.classList.remove('active'));
                document.querySelector('.cart-tab').classList.add('active');
                document.querySelector('.cart-section').classList.add('active');
            });

            // Проверка доступности Telegram API
            async function checkTelegramApi() {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/getMe`);
                    if (!response.ok) {
                        console.error('Telegram API недоступен');
                        alert('Проблемы с подключением к Telegram. Некоторые функции могут не работать.');
                    }
                } catch (error) {
                    console.error('Ошибка проверки Telegram API:', error);
                }
            }

            checkTelegramApi();

            // Автоматическое обновление статуса кнопок при загрузке
            function updateButtonStates() {
                document.querySelectorAll('button').forEach(button => {
                    if (button.disabled) {
                        button.style.opacity = '0.6';
                    } else {
                        button.style.opacity = '1';
                    }
                });
            }

            // Вызов функции обновления состояния кнопок
            updateButtonStates();

            // Обновление состояния кнопок при каждом изменении
            document.addEventListener('click', updateButtonStates);
            document.addEventListener('input', updateButtonStates);

            // Поддержка темной темы по умолчанию
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-theme');
            }

            // Обработка ошибок загрузки изображений
            imagePreview.addEventListener('error', () => {
                imagePreview.style.display = 'none';
                alert('Не удалось загрузить изображение. Попробуйте другое.');
            });

                        // Логирование активности пользователя для отладки
            function logUserAction(action) {
                console.log(`Пользователь ${localStorage.getItem('nickname') || 'Гость'} выполнил действие: ${action}`);
            }

            // Логирование основных действий пользователя
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart')) {
                    logUserAction(`Добавление в корзину: ${e.target.dataset.name}`);
                } else if (e.target.classList.contains('remove-from-cart')) {
                    logUserAction(`Удаление из корзины: индекс ${e.target.dataset.index}`);
                } else if (e.target === cartCheckout) {
                    logUserAction('Оформление заказа');
                } else if (e.target === clearHistory) {
                    logUserAction('Очистка истории покупок');
                } else if (e.target === submitReview) {
                    logUserAction('Отправка отзыва');
                } else if (e.target === deleteReview) {
                    logUserAction('Удаление отзыва');
                } else if (e.target.classList.contains('tab')) {
                    logUserAction(`Переключение вкладки: ${e.target.dataset.tab}`);
                }
            });

            // Обработка двойных кликов для предотвращения множественных действий
            let isProcessing = false;
            function preventDoubleClick(action) {
                if (isProcessing) return;
                isProcessing = true;
                action();
                setTimeout(() => {
                    isProcessing = false;
                }, 500);
            }

            // Переопределение обработчиков для предотвращения двойных кликов
            addBondsV2ToCart.addEventListener('click', () => {
                preventDoubleClick(() => {
                    const name = `Облигации v2 (${bondsV2Quantity} мин.)`;
                    const price = bondsV2Quantity * bondV2Price;
                    addToCart(name, price);
                    bondsV2Quantity = 1;
                    updateBondsV2Display();
                });
            });

            addWinsToCart.addEventListener('click', () => {
                preventDoubleClick(() => {
                    const name = `Накрутка побед (${winsQuantity} шт.)`;
                    const price = winsQuantity * winPrice;
                    addToCart(name, price);
                    winsQuantity = 1;
                    updateWinsDisplay();
                });
            });

            cartCheckout.addEventListener('click', (e) => {
                e.preventDefault();
                preventDoubleClick(() => {
                    if (cart.length > 0) {
                        checkout();
                        warningModal.style.display = 'flex';
                        setTimeout(() => {
                            closeWarning.classList.add('active');
                        }, 5000);
                    }
                });
            });

            // Обработка событий касания для мобильных устройств
            document.addEventListener('touchstart', (e) => {
                if (e.target.classList.contains('add-to-cart')) {
                    e.preventDefault();
                    const name = e.target.dataset.name;
                    const price = e.target.dataset.price;
                    preventDoubleClick(() => addToCart(name, price));
                } else if (e.target.classList.contains('remove-from-cart')) {
                    e.preventDefault();
                    const index = e.target.dataset.index;
                    preventDoubleClick(() => removeFromCart(index));
                }
            });

            // Автоматическое сохранение состояния фильтров
            function saveFilterState() {
                localStorage.setItem('search', searchInput.value);
                localStorage.setItem('category', categorySelect.value);
                localStorage.setItem('sort', sortSelect.value);
            }

            // Восстановление состояния фильтров
            function restoreFilterState() {
                searchInput.value = localStorage.getItem('search') || '';
                categorySelect.value = localStorage.getItem('category') || 'all';
                sortSelect.value = localStorage.getItem('sort') || 'default';
                filterAndSortItems();
            }

            searchInput.addEventListener('input', saveFilterState);
            categorySelect.addEventListener('change', saveFilterState);
            sortSelect.addEventListener('change', saveFilterState);

            // Инициализация восстановления фильтров
            restoreFilterState();

            // Проверка валидности цен при загрузке
            function validatePrices() {
                document.querySelectorAll('.item, .quest').forEach(item => {
                    const price = Number(item.dataset.price);
                    if (isNaN(price) || price <= 0) {
                        console.warn(`Некорректная цена для ${item.dataset.name}: ${item.dataset.price}`);
                        item.querySelector('button').disabled = true;
                    }
                });
            }

            validatePrices();

            // Обработка фокуса на полях ввода
            document.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('focus', () => {
                    input.style.borderColor = '#047857';
                });
                input.addEventListener('blur', () => {
                    input.style.borderColor = '#333';
                });
            });

            // Поддержка клавиатурной навигации
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    const activeTab = document.querySelector('.tab.active');
                    if (activeTab) {
                        const tabsArray = Array.from(tabs);
                        const currentIndex = tabsArray.indexOf(activeTab);
                        let nextIndex = currentIndex;
                        if (e.shiftKey) {
                            nextIndex = currentIndex - 1 < 0 ? tabsArray.length - 1 : currentIndex - 1;
                        } else {
                            nextIndex = currentIndex + 1 >= tabsArray.length ? 0 : currentIndex + 1;
                        }
                        tabsArray[nextIndex].click();
                        e.preventDefault();
                    }
                }
            });

            // Обработка загрузки изображений для элементов каталога
            function loadItemImages() {
                document.querySelectorAll('.item-image, .quest-image').forEach(img => {
                    if (!img.src || img.src.endsWith('/')) {
                        img.src = 'https://via.placeholder.com/150?text=Image+Not+Found';
                        img.alt = 'Изображение недоступно';
                    }
                });
            }

            loadItemImages();

            // Проверка целостности данных в localStorage
            function validateLocalStorage() {
                try {
                    const testCart = JSON.parse(localStorage.getItem('cart'));
                    const testHistory = JSON.parse(localStorage.getItem('purchaseHistory'));
                    if (!Array.isArray(testCart)) {
                        localStorage.setItem('cart', JSON.stringify([]));
                        cart = [];
                    }
                    if (!Array.isArray(testHistory)) {
                        localStorage.setItem('purchaseHistory', JSON.stringify([]));
                        purchaseHistory = [];
                    }
                } catch (error) {
                    console.error('Ошибка валидации localStorage:', error);
                    localStorage.setItem('cart', JSON.stringify([]));
                    localStorage.setItem('purchaseHistory', JSON.stringify([]));
                    cart = [];
                    purchaseHistory = [];
                }
                updateCartDisplay();
                updateHistoryDisplay();
            }

            validateLocalStorage();

            // Автоматическое обновление корзины при изменении localStorage
            window.addEventListener('storage', (e) => {
                if (e.key === 'cart') {
                    cart = JSON.parse(localStorage.getItem('cart')) || [];
                    updateCartCount();
                    updateCartDisplay();
                } else if (e.key === 'purchaseHistory') {
                    purchaseHistory = JSON.parse(localStorage.getItem('purchaseHistory')) || [];
                    updateHistoryDisplay();
                } else if (e.key === 'nickname') {
                    updateNicknameDisplay();
                    checkUserReview();
                }
            });

            // Оптимизация производительности при прокрутке
            let isScrolling = false;
            window.addEventListener('scroll', () => {
                if (!isScrolling) {
                    window.requestAnimationFrame(() => {
                        // Оптимизация анимации при прокрутке
                        document.querySelectorAll('.item, .quest').forEach(item => {
                            const rect = item.getBoundingClientRect();
                            if (rect.top < window.innerHeight && rect.bottom > 0) {
                                item.style.opacity = '1';
                                item.style.transform = 'translateY(0)';
                            }
                        });
                        isScrolling = false;
                    });
                    isScrolling = true;
                }
            });

            // Обработка ошибок сети
            window.addEventListener('offline', () => {
                alert('Вы оффлайн. Некоторые функции могут быть недоступны.');
            });

            window.addEventListener('online', () => {
                checkTelegramApi();
            });

            // Добавление плавной прокрутки для якорей
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = anchor.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Поддержка accessibility (доступности)
            document.querySelectorAll('button, input, select, textarea').forEach(element => {
                if (!element.getAttribute('aria-label')) {
                    element.setAttribute('aria-label', element.textContent || element.placeholder || 'Интерактивный элемент');
                }
            });

            // Обработка изменения языка
            function updateLanguage() {
                const lang = navigator.language || navigator.userLanguage;
                if (lang !== 'ru-RU') {
                    console.log(`Обнаружен язык: ${lang}. Текущая версия поддерживает только русский.`);
                }
            }

            updateLanguage();

            // Проверка устаревших данных в localStorage
            function clearOldData() {
                const lastClear = localStorage.getItem('lastClear') || 0;
                const now = Date.now();
                const weekInMs = 7 * 24 * 60 * 60 * 1000;
                if (now - lastClear > weekInMs) {
                    localStorage.setItem('purchaseHistory', JSON.stringify([]));
                    localStorage.setItem('lastClear', now);
                    purchaseHistory = [];
                    updateHistoryDisplay();
                }
            }

            clearOldData();

            // Добавление подсказок для пользователей
            function addTooltips() {
                document.querySelectorAll('.add-to-cart').forEach(button => {
                    button.title = 'Добавить товар в корзину';
                });
                document.querySelectorAll('.remove-from-cart').forEach(button => {
                    button.title = 'Удалить товар из корзины';
                });
                cartCheckout.title = 'Перейти к оформлению заказа';
                clearHistory.title = 'Очистить историю покупок';
                submitReview.title = 'Отправить отзыв';
                deleteReview.title = 'Удалить ваш последний отзыв';
            }

            addTooltips();

            // Обработка долгого нажатия для мобильных устройств
            let touchTimeout;
            document.addEventListener('touchstart', (e) => {
                touchTimeout = setTimeout(() => {
                    if (e.target.classList.contains('item') || e.target.classList.contains('quest')) {
                        alert(`Подробности: ${e.target.dataset.name} - ${e.target.dataset.price} тг`);
                    }
                }, 1000);
            });

            document.addEventListener('touchend', () => {
                clearTimeout(touchTimeout);
            });

            document.addEventListener('touchcancel', () => {
                clearTimeout(touchTimeout);
            });

            // Проверка поддержки WebP
            function checkWebPSupport() {
                const img = new Image();
                img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
                img.onload = () => {
                    document.body.classList.add('webp-supported');
                };
                img.onerror = () => {
                    document.body.classList.add('no-webp');
                };
            }

            checkWebPSupport();

            // Оптимизация изображений для Retina-дисплеев
            function optimizeImages() {
                if (window.devicePixelRatio > 1) {
                    document.querySelectorAll('.item-image, .quest-image').forEach(img => {
                        if (img.src.includes('placeholder')) {
                            img.src = 'https://via.placeholder.com/300?text=Image+Not+Found';
                        }
                    });
                }
            }

            optimizeImages();

            // Обработка изменения ориентации экрана
            window.addEventListener('orientationchange', () => {
                filterAndSortItems();
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });

            // Поддержка горячих клавиш
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    searchInput.focus();
                } else if (e.key === 'Escape') {
                    if (nicknameModal.style.display === 'flex') {
                        nicknameModal.style.display = 'none';
                    } else if (warningModal.style.display === 'flex') {
                        warningModal.style.display = 'none';
                    }
                }
            });

            // Проверка производительности
            let lastFrameTime = performance.now();
            function checkPerformance() {
                const now = performance.now();
                const fps = 1000 / (now - lastFrameTime);
                lastFrameTime = now;
                if (fps < 30) {
                    console.warn('Низкая производительность: ', fps.toFixed(2), 'FPS');
                }
                requestAnimationFrame(checkPerformance);
            }

            checkPerformance();

            // Автоматическое обновление цен (если нужно)
            function updateDynamicPrices() {
                // Placeholder для будущей логики динамического обновления цен
                console.log('Проверка обновления цен...');
            }

            setInterval(updateDynamicPrices, 60000);

            // Обработка drag-and-drop для загрузки изображений в отзывах
            const fileInputContainer = document.querySelector('.file-input-container');
            fileInputContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileInputContainer.style.background = '#262626';
            });

            fileInputContainer.addEventListener('dragleave', () => {
                fileInputContainer.style.background = 'none';
            });

            fileInputContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                fileInputContainer.style.background = 'none';
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    reviewImage.files = e.dataTransfer.files;
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        imagePreview.src = ev.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                    updateSubmitButton();
                } else {
                    alert('Пожалуйста, загрузите изображение!');
                }
            });

            // Поддержка копирования текста отзыва
            reviewText.addEventListener('contextmenu', (e) => {
                if (reviewText.value.trim()) {
                    navigator.clipboard.writeText(reviewText.value).then(() => {
                        alert('Текст отзыва скопирован в буфер обмена.');
                    });
                }
            });

            // Проверка устаревших отзывов
            function clearOldReviews() {
                const nickname = localStorage.getItem('nickname') || 'Гость';
                const lastReview = JSON.parse(localStorage.getItem(`lastReview_${nickname}`));
                if (lastReview) {
                    const { timestamp } = lastReview;
                    const now = Date.now();
                    const hoursPassed = (now - timestamp) / (1000 * 60 * 60);
                    if (hoursPassed > 48) {
                        localStorage.removeItem(`lastReview_${nickname}`);
                        deleteReview.disabled = true;
                    }
                }
            }

            setInterval(clearOldReviews, 3600000); // Проверка каждые час

            // Инициализация всех обработчиков
            function initializeEventListeners() {
                document.querySelectorAll('.item, .quest').forEach(item => {
                    item.addEventListener('mouseenter', () => {
                        item.style.transition = 'transform 0.3s, box-shadow 0.3s';
                    });
                    item.addEventListener('mouseleave', () => {
                        item.style.transition = 'transform 0.3s, box-shadow 0.3s';
                    });
                });
            }

            initializeEventListeners();

            // Финальная инициализация
            console.log('Приложение инициализировано успешно.');
        });
